/**** 
A checking program based on the code from 
Zou, J., Wei, Z., Sun, S., Liu, X. and Wu, W., December. Quantum Circuit Implementations of AES with Fewer Qubits. Advances in Cryptology â€“ ASIACRYPT
2020, pp. 697-726. Springer, Cham, 2020,  and https://github.com/Asiacrypt2020submission370/
aes/.

*/

#include <stdio.h>
#include <stdlib.h>

/****** 
 * The input of Algorithm 3 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0.
 * The output of Algorithm 3 can be explained as follows:
 * U[0]=y_19, U[1]=y_4, U[2]=y_2, U[3]=y_5, U[4]=y_14, U[5]=y_6, U[6]=y_21, U[7]=x_7;
 * T[0]=t_24, T[1]=t_37, T[2]=t_29, T[3]=t_40, T[4]=t_27, T[5]=t_33.
******/
void algorithm_3(int U[], int T[])
{
    U[0] = U[0] ^ U[6];               //U[0]=y_13
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5]; //U[6]=y_16
    T[0] = (U[0] & U[6]) ^ T[0];      //T[0]=t_7
    T[1] = T[1] ^ T[0];               //T[1]=t_7

    U[1] = U[1] ^ U[2] ^ U[7];               //U[1]=y_1
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6]; //U[2]=y_5
    T[1] = (U[1] & U[2]) ^ T[1];             //T[1]=t_9

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3]; //U[0]=y_9
    U[6] = U[6] ^ U[1] ^ U[7];        //U[6]=y_11
    T[2] = (U[0] & U[6]) ^ T[2];      //T[2]=t_12
    T[3] = T[3] ^ T[2];               //T[3]=t_12

    U[5] = U[5] ^ U[3];                      //U[5]=y_14
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; //U[0]=y_17
    T[3] = (U[5] & U[0]) ^ T[3];             // T[3]=t_14
    T[1] = T[1] ^ T[3];                      //  T[1]=t_19

    U[0] = U[0] ^ U[3] ^ U[4]; //  U[0]=y_21
    T[1] = T[1] ^ U[0];        //  T[1]=t_23

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7]; //U[0]=y_2
    U[6] = U[6] ^ U[7];                      //U[6]=y_7
    T[0] = (U[0] & U[6]) ^ T[0];             //T[0]=t_11

    U[0] = U[0] ^ U[2] ^ U[5];        // U[0]=y_12
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4]; // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];      // T[4]=t_2, ** first computation of t_2=U[0]& U[5]

    T[3] = T[3] ^ T[4];          // T[3]=t_19^t_2
    U[0] = U[0] ^ U[1] ^ U[3];   // U[0]=y_3
    U[5] = U[5] ^ U[7];          // U[5]=y_6
    T[3] = (U[0] & U[5]) ^ T[3]; // T[3]=t_19^t_4

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_20
    T[3] = T[3] ^ U[1];                      //  T[3]=t_21

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6]; // U[1]=y_10
    U[0] = U[0] ^ U[2];               // U[0]=y_8
    T[2] = (U[1] & U[0]) ^ T[2];      // T[2]=t_16
    T[0] = T[0] ^ T[2];               // T[0]=t_20
    T[2] = T[2] ^ T[4];               // T[2]=t_16^t_2

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5]; // U[0]=y_12
    U[5] = U[5] ^ U[7];                      // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];             // T[4]=0, ** second computation of t_2=U[0]& U[5]

    // As shown in the above (with **), we need to compute t_2 two times.
    // If we introduce a new qubit (i.e. T[6]) to store t_2, we can save one Toffoli gate and one Toffoli depth.

    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6]; // U[2]=y_18
    T[0] = T[0] ^ U[2];                      // T[0]=t_24

    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7]; // U[1]=y_4
    T[2] = (U[1] & U[7]) ^ T[2];      // T[2]=t_18

    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; // U[0]=y_19
    T[2] = T[2] ^ U[0];                      // T[2]=t_22

    T[4] = (T[1] & T[3]) ^ T[4]; // T[4]=t_26
    T[1] = T[1] ^ T[0];          // T[1]=t_30
    T[4] = T[4] ^ T[2];          // T[4]=t_31
    T[5] = (T[1] & T[4]) ^ T[5]; // T[5]=t_32
    T[5] = T[5] ^ T[0];          // T[5]=t_33
    T[1] = T[1] ^ T[0] ^ T[5];   // T[1]=t_34
    T[4] = T[4] ^ T[2] ^ T[0];   // T[4]=t_27
    T[5] = T[5] ^ T[4];          // T[5]=t_35
    T[1] = (T[0] & T[5]) ^ T[1]; // T[1]=t_37  *** first computation of t_36=T[0]& T[5]
    T[3] = T[3] ^ T[2];          // T[3]=t_25
    T[2] = (T[3] & T[4]) ^ T[2]; // T[2]=t_29
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_38  *** second computation of t_36=T[0]& T[5]
    T[3] = (T[2] & T[4]) ^ T[3]; // T[3]=t_40
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_27  *** third computation of t_36=T[0]& T[5]
    T[5] = T[5] ^ T[4];          // T[5]=t_33

    // As shown in the above (with ***), we need to compute t_36 three times.
    // If we introduce a new qubit (i.e. T[7]) to store t_36, we can save two Toffoli gate and two Toffoli depth.

    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];        // U[3]=y_5
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];               // U[4]=y_14
    U[2] = U[2] ^ U[6];                             // U[2]=y_2
    U[5] = U[5] ^ U[7];                             // U[5]=y_6
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5]; // U[6]=y_21
}

/******
 * The input of Algorithm 4 can be explained as follows:
 * U[0]=y_19, U[1]=y_4, U[2]=y_2, U[3]=y_5, U[4]=y_14, U[5]=y_6, U[6]=y_21, U[7]=x_7;
 * T[0]=t_24, T[1]=t_37, T[2]=t_29, T[3]=t_40, T[4]=t_27, T[5]=t_33;
 * S[0]=0, S[1]=0, S[2]=0, S[3]=0, S[4]=0, S[5]=0, S[6]=0, S[7]=0.
 * The output of Algorithm 4 can be explained as follows:
 * U[0]=x_0, U[1]=x_1, U[2]=x_2, U[3]=x_3, U[4]=x_4, U[5]=x_5, U[6]=x_6, U[7]=x_7;
 * T[0]=0, T[1]=0, T[2]=0, T[3]=0, T[4]=0, T[5]=0;
 * S[0]=s_0, S[1]=s_1, S[2]=s_2, S[3]=s_3, S[4]=s_4, S[5]=s_5, S[6]=s_6, S[7]=s_7.
******/
void algorithm_4(int U[], int T[], int S[], int j)
{
    /*** This part is used to generate the output of S-box, the result is stored in S[] ***/
    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_10
    T[3] = T[3] ^ T[1];               // T[3]=t_41   // t_41

    S[5] = (T[3] & U[1]) ^ S[5]; //  T[3]& U[1]=z_8 and S[5]=z_8
    S[6] = S[6] ^ S[5];          //  S[6]=z_8

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];               // T[3]=t_33

    // S[0]=0,  S[1]=0 ,   S[2]=0,   S[3]=0,
    // S[4]=0,  S[5]=z_8,  S[6]=z_8, S[7]=0,

    S[2] = (T[2] & U[2]) ^ S[2]; // T[2]& U[2]=z_14 and S[2]=z_14
    S[5] = S[2] ^ S[5];          // S[5]=z_8^z_14
    S[2] = S[2] ^ S[6];          // S[2]=z_8^z_14
    
    // S[0]=0,  S[1]=0 ,        S[2]=z_8^z_14,   S[3]=0,
    // S[4]=0,  S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    S[4] = (T[1] & U[5]) ^ S[4]; //  T[1]& U[5]=z_1
    S[1] = S[1] ^ S[4];          //  S[1]=z_1
    S[3] = S[3] ^ S[4];          //  S[3]=z_1

    // S[0]=0,   S[1]=z_1,       S[2]=z_8^z_14,   S[3]=z_1,
    // S[4]=z_1, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    U[5] = U[5] ^ U[7]; // U[5]=y_15
    T[1] = T[1] ^ T[5]; // T[1]=t_44

    S[7] = (T[1] & U[5]) ^ S[7]; // T[1]& U[5]=z_0 and S[7]=z_0
    S[1] = S[1] ^ S[7];          // S[1]=z_1^z_0
    S[3] = S[3] ^ S[7];          // S[3]=z_1^z_0
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_0

    U[5] = U[5] ^ U[7]; // U[5]=y_6
    T[1] = T[1] ^ T[5]; // T[1]=t_37

    // S[0]=0,       S[1]=z_1^z_0,   S[2]=z_8^z_14,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=z_0,

    S[7] = (T[5] & U[7]) ^ S[7]; // T[5]& U[7]=z_2 and S[7]=z_0^z_2
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2
    S[6] = S[6] ^ S[7];          // S[6]=z_8^z_0^z_2

    // S[0]=0,       S[1]=z_1^z_0,           S[2]=z_8^z_14^z_0^z_2,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14^z_0^z_2,  S[6]=z_8^z_0^z_2,        S[7]=z_0^z_2,

    // Done

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_7

    S[7] = (T[2] & U[1]) ^ S[7]; // T[2]& U[1]=z_5 and S[7]=z_0^z_2^z_5
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_5
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_2^z_5
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_5

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_4

    // S[0]=0,           S[1]=z_1^z_0,       S[2]=z_8^z_14^z_5,   S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_5,  S[6]=z_8^z_0^z_2,    S[7]=z_0^z_2^z_5,

    U[2] = U[2] ^ U[3]; // U[2]=y_13
    T[3] = T[3] ^ T[2]; // T[3]=t_43

    S[7] = (T[3] & U[2]) ^ S[7]; // T[3]& U[2]=z_12 and S[7]=z_0^z_2^z_5^z_12
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2^z_12
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2^z_12

    U[2] = U[2] ^ U[3]; // U[2]=y_2
    T[3] = T[3] ^ T[2]; // T[3]=t_40

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_0^z_2,            S[7]=z_0^z_2^z_5^z_12,

    S[7] = (T[3] & U[3]) ^ S[7]; //T[3]& U[3]=z_13 and S[7]=z_0^z_2^z_5^z_12^z_13
    S[6] = S[6] ^ S[7];          //S[6]= z_8^z_5^z_12^z_13

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13,      S[7]=z_0^z_2^z_5^z_12^z_13,

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_16
    T[2] = T[3] ^ T[2];        // T[2]=t_43

    S[0] = (T[2] & U[6]) ^ S[0]; // T[2]& U[6]=z_3 and S[0]=z_3
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_3
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_21
    T[2] = T[3] ^ T[2];        // T[2]=t_29

    // S[0]=z_3,              S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5^z_3,  S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13^z_3,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_1

    S[0] = (T[3] & U[1]) ^ S[0]; // T[3]& U[1]=z_4 and S[0]=z_3^z_4
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_3^z_4
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_4

    // S[0]=z_3^z_4,          S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[6]=z_8^z_5^z_12^z_13^z_4,          S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_11
    T[5] = T[5] ^ T[2];                                    // T[5]=t_42

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_6 and S[0]=z_3^z_4^z_6
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_6
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_5
    T[5] = T[5] ^ T[2];                                    // T[5]=t_33

    // S[0]=z_3^z_4^z_6,      S[1]=z_1^z_0^z_3^z_4,            S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6,  S[6]=z_8^z_5^z_12^z_13^z_3^z_6,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_17
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_45

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_7 and S[0]=z_3^z_4^z_6^z_7
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_6^z_7
    S[4] = S[4] ^ S[0];          // S[4]= z_1^z_2^z_5^z_3^z_6^z_7
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_5
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7,          S[1]=z_1^z_0^z_3^z_4,                    S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_12
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    S[0] = (T[5] & U[2]) ^ S[0]; // T[5]& U[2]=z_9 and S[0]=z_3^z_4^z_6^z_7^z_9
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_2
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9,      S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_3

    S[0] = (T[1] & U[1]) ^ S[0]; // T[1]& U[1]=z_10 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_4

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10,
    // S[3]=z_1^z_0^z_6^z_7,           S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                       S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    U[1] = U[1] ^ U[2]; // U[1]=y_9
    T[5] = T[5] ^ T[2]; // T[5]=t_42

    S[0] = (T[5] & U[1]) ^ S[0]; // T[5]& U[1]=z_15 and S[0]= z_3^z_4^z_6^z_7^z_9^z_10^z_15
    S[2] = S[2] ^ S[0];          // S[2]= z_8^z_14^z_0^z_2^z_12^z_6^z_15

    U[1] = U[1] ^ U[2]; // U[1]=y_4
    T[5] = T[5] ^ T[2]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_6^z_7,                S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                            S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_45

    S[0] = (T[5] & U[4]) ^ S[0]; // T[5]& U[4]=z_16 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_8
    T[3] = T[3] ^ T[1];        // T[3]=t_41

    S[2] = (T[3] & U[1]) ^ S[2]; // T[3]& U[1]=z_17 and S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];        // T[3]=t_40

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    S[5] = (T[5] & U[1]) ^ S[5]; //  T[5]& U[1]=z_11 and S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    j = 1 ^ S[1];
    S[1] = j;

    j = 1 ^ S[2];
    S[2] = j;

    j = 1 ^ S[6];
    S[6] = j;

    j = 1 ^ S[7];
    S[7] = j;

    /*** This part is used to generate the input of S-box, the result is stored in U[] ***/
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5];
    U[5] = U[5] ^ U[7];
    U[2] = U[2] ^ U[6];
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];
    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[5] = T[5] ^ T[4];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[3] = (T[2] & T[4]) ^ T[3];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[2] = (T[3] & T[4]) ^ T[2];
    T[3] = T[3] ^ T[2];
    T[1] = (T[0] & T[5]) ^ T[1];
    T[5] = T[5] ^ T[4];

    T[4] = T[4] ^ T[2] ^ T[0];
    T[1] = T[1] ^ T[0] ^ T[5];
    T[5] = T[5] ^ T[0];
    T[5] = (T[1] & T[4]) ^ T[5];
    T[4] = T[4] ^ T[2];
    T[1] = T[1] ^ T[0];
    T[4] = (T[1] & T[3]) ^ T[4];

    T[2] = T[2] ^ U[0];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];

    T[2] = (U[1] & U[7]) ^ T[2];
    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7];

    T[0] = T[0] ^ U[2];
    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5];

    T[2] = T[2] ^ T[4];
    T[0] = T[0] ^ T[2];
    T[2] = (U[1] & U[0]) ^ T[2];
    U[0] = U[0] ^ U[2];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6];

    T[3] = T[3] ^ U[1];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[3] = (U[0] & U[5]) ^ T[3];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[3];
    T[3] = T[3] ^ T[4];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4];
    U[0] = U[0] ^ U[2] ^ U[5];

    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7];

    T[1] = T[1] ^ U[0];
    U[0] = U[0] ^ U[3] ^ U[4];

    T[1] = T[1] ^ T[3];
    T[3] = (U[5] & U[0]) ^ T[3];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];
    U[5] = U[5] ^ U[3];

    T[3] = T[3] ^ T[2];
    T[2] = (U[0] & U[6]) ^ T[2];
    U[6] = U[6] ^ U[1] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3];

    T[1] = (U[1] & U[2]) ^ T[1];
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6];
    U[1] = U[1] ^ U[2] ^ U[7];

    T[1] = T[1] ^ T[0];
    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5];
    U[0] = U[0] ^ U[6];
}


void algorithm_L(int U[], int T[], int S[], int j)
{
	/*
  ********    A^{-1} with 10 CNOT gates *********
*/

 
S[2] = S[2]^S[6];
S[3] = S[3]^S[7];
S[1] = S[1]^S[4];
S[3] = S[3]^S[4];
S[5] = S[5]^S[0];
S[7] = S[7]^S[0];
S[1] = S[1]^S[7];
S[5] = S[5]^S[2];
S[6] = S[6]^S[5];
S[2] = S[2]^S[7];
/******************************************/

	
	/*** This part is used to generate the output of S-box, the result is stored in S[] ***/
    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_10
    T[3] = T[3] ^ T[1];               // T[3]=t_41

    S[5] = (T[3] & U[1]) ^ S[5]; //  T[3]& U[1]=z_8 and S[5]=z_8
    S[6] = S[6] ^ S[5];          //  S[6]=z_8

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];               // T[3]=t_33

    // S[0]=0,  S[1]=0 ,   S[2]=0,   S[3]=0,
    // S[4]=0,  S[5]=z_8,  S[6]=z_8, S[7]=0,

    S[2] = (T[2] & U[2]) ^ S[2]; // T[2]& U[2]=z_14 and S[2]=z_14
    S[5] = S[2] ^ S[5];          // S[5]=z_8^z_14
    S[2] = S[2] ^ S[6];          // S[2]=z_8^z_14
    
    // S[0]=0,  S[1]=0 ,        S[2]=z_8^z_14,   S[3]=0,
    // S[4]=0,  S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    S[4] = (T[1] & U[5]) ^ S[4]; //  T[1]& U[5]=z_1
    S[1] = S[1] ^ S[4];          //  S[1]=z_1
    S[3] = S[3] ^ S[4];          //  S[3]=z_1

    // S[0]=0,   S[1]=z_1,       S[2]=z_8^z_14,   S[3]=z_1,
    // S[4]=z_1, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    U[5] = U[5] ^ U[7]; // U[5]=y_15
    T[1] = T[1] ^ T[5]; // T[1]=t_44

    S[7] = (T[1] & U[5]) ^ S[7]; // T[1]& U[5]=z_0 and S[7]=z_0
    S[1] = S[1] ^ S[7];          // S[1]=z_1^z_0
    S[3] = S[3] ^ S[7];          // S[3]=z_1^z_0
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_0

    U[5] = U[5] ^ U[7]; // U[5]=y_6
    T[1] = T[1] ^ T[5]; // T[1]=t_37

    // S[0]=0,       S[1]=z_1^z_0,   S[2]=z_8^z_14,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=z_0,

    S[7] = (T[5] & U[7]) ^ S[7]; // T[5]& U[7]=z_2 and S[7]=z_0^z_2
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2
    S[6] = S[6] ^ S[7];          // S[6]=z_8^z_0^z_2

    // S[0]=0,       S[1]=z_1^z_0,           S[2]=z_8^z_14^z_0^z_2,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14^z_0^z_2,  S[6]=z_8^z_0^z_2,        S[7]=z_0^z_2,

    // Done

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_7

    S[7] = (T[2] & U[1]) ^ S[7]; // T[2]& U[1]=z_5 and S[7]=z_0^z_2^z_5
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_5
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_2^z_5
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_5

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_4

    // S[0]=0,           S[1]=z_1^z_0,       S[2]=z_8^z_14^z_5,   S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_5,  S[6]=z_8^z_0^z_2,    S[7]=z_0^z_2^z_5,

    U[2] = U[2] ^ U[3]; // U[2]=y_13
    T[3] = T[3] ^ T[2]; // T[3]=t_43

    S[7] = (T[3] & U[2]) ^ S[7]; // T[3]& U[2]=z_12 and S[7]=z_0^z_2^z_5^z_12
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2^z_12
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2^z_12

    U[2] = U[2] ^ U[3]; // U[2]=y_2
    T[3] = T[3] ^ T[2]; // T[3]=t_40

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_0^z_2,            S[7]=z_0^z_2^z_5^z_12,

    S[7] = (T[3] & U[3]) ^ S[7]; //T[3]& U[3]=z_13 and S[7]=z_0^z_2^z_5^z_12^z_13
    S[6] = S[6] ^ S[7];          //S[6]= z_8^z_5^z_12^z_13

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13,      S[7]=z_0^z_2^z_5^z_12^z_13,

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_16
    T[2] = T[3] ^ T[2];        // T[2]=t_43

    S[0] = (T[2] & U[6]) ^ S[0]; // T[2]& U[6]=z_3 and S[0]=z_3
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_3
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_21
    T[2] = T[3] ^ T[2];        // T[2]=t_29

    // S[0]=z_3,              S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5^z_3,  S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13^z_3,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_1

    S[0] = (T[3] & U[1]) ^ S[0]; // T[3]& U[1]=z_4 and S[0]=z_3^z_4
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_3^z_4
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_4

    // S[0]=z_3^z_4,          S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[6]=z_8^z_5^z_12^z_13^z_4,          S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_11
    T[5] = T[5] ^ T[2];                                    // T[5]=t_42

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_6 and S[0]=z_3^z_4^z_6
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_6
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_5
    T[5] = T[5] ^ T[2];                                    // T[5]=t_33

    // S[0]=z_3^z_4^z_6,      S[1]=z_1^z_0^z_3^z_4,            S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6,  S[6]=z_8^z_5^z_12^z_13^z_3^z_6,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_17
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_45

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_7 and S[0]=z_3^z_4^z_6^z_7
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_6^z_7
    S[4] = S[4] ^ S[0];          // S[4]= z_1^z_2^z_5^z_3^z_6^z_7
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_5
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7,          S[1]=z_1^z_0^z_3^z_4,                    S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_12
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    S[0] = (T[5] & U[2]) ^ S[0]; // T[5]& U[2]=z_9 and S[0]=z_3^z_4^z_6^z_7^z_9
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_2
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9,      S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_3

    S[0] = (T[1] & U[1]) ^ S[0]; // T[1]& U[1]=z_10 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_4

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10,
    // S[3]=z_1^z_0^z_6^z_7,           S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                       S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    U[1] = U[1] ^ U[2]; // U[1]=y_9
    T[5] = T[5] ^ T[2]; // T[5]=t_42

    S[0] = (T[5] & U[1]) ^ S[0]; // T[5]& U[1]=z_15 and S[0]= z_3^z_4^z_6^z_7^z_9^z_10^z_15
    S[2] = S[2] ^ S[0];          // S[2]= z_8^z_14^z_0^z_2^z_12^z_6^z_15

    U[1] = U[1] ^ U[2]; // U[1]=y_4
    T[5] = T[5] ^ T[2]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_6^z_7,                S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                            S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_45

    S[0] = (T[5] & U[4]) ^ S[0]; // T[5]& U[4]=z_16 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_8
    T[3] = T[3] ^ T[1];        // T[3]=t_41

    S[2] = (T[3] & U[1]) ^ S[2]; // T[3]& U[1]=z_17 and S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];        // T[3]=t_40

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    S[5] = (T[5] & U[1]) ^ S[5]; //  T[5]& U[1]=z_11 and S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    j = 1 ^ S[1];
    S[1] = j;

    j = 1 ^ S[2];
    S[2] = j;

    j = 1 ^ S[6];
    S[6] = j;

    j = 1 ^ S[7];
    S[7] = j;

    /*** This part is used to generate the input of S-box, the result is stored in U[] ***/
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5];
    U[5] = U[5] ^ U[7];
    U[2] = U[2] ^ U[6];
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];
    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[5] = T[5] ^ T[4];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[3] = (T[2] & T[4]) ^ T[3];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[2] = (T[3] & T[4]) ^ T[2];
    T[3] = T[3] ^ T[2];
    T[1] = (T[0] & T[5]) ^ T[1];
    T[5] = T[5] ^ T[4];

    T[4] = T[4] ^ T[2] ^ T[0];
    T[1] = T[1] ^ T[0] ^ T[5];
    T[5] = T[5] ^ T[0];
    T[5] = (T[1] & T[4]) ^ T[5];
    T[4] = T[4] ^ T[2];
    T[1] = T[1] ^ T[0];
    T[4] = (T[1] & T[3]) ^ T[4];

    T[2] = T[2] ^ U[0];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];

    T[2] = (U[1] & U[7]) ^ T[2];
    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7];

    T[0] = T[0] ^ U[2];
    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5];

    T[2] = T[2] ^ T[4];
    T[0] = T[0] ^ T[2];
    T[2] = (U[1] & U[0]) ^ T[2];
    U[0] = U[0] ^ U[2];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6];

    T[3] = T[3] ^ U[1];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[3] = (U[0] & U[5]) ^ T[3];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[3];
    T[3] = T[3] ^ T[4];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4];
    U[0] = U[0] ^ U[2] ^ U[5];

    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7];

    T[1] = T[1] ^ U[0];
    U[0] = U[0] ^ U[3] ^ U[4];

    T[1] = T[1] ^ T[3];
    T[3] = (U[5] & U[0]) ^ T[3];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];
    U[5] = U[5] ^ U[3];

    T[3] = T[3] ^ T[2];
    T[2] = (U[0] & U[6]) ^ T[2];
    U[6] = U[6] ^ U[1] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3];

    T[1] = (U[1] & U[2]) ^ T[1];
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6];
    U[1] = U[1] ^ U[2] ^ U[7];

    T[1] = T[1] ^ T[0];
    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5];
    U[0] = U[0] ^ U[6];
}






void algorithm_R1(int U[], int T[])
{
    int temp[8];

	int j=0;
	    j = 1 ^ U[1];
    U[1] = j;

    j = 1 ^ U[2];
    U[2] = j;

    j = 1 ^ U[6];
    U[6] = j;

    j = 1 ^ U[7];
    U[7] = j;


 /*************inverse L part by rewiring and 14 CNOT gates*********/


temp[0] = U[0];
temp[1] = U[1];
temp[2] = U[2];
temp[3] = U[3];
temp[4] = U[4];
temp[5] = U[5];
temp[6] = U[6];
temp[7] = U[7];


 U[0] = temp[3];
 U[1] = temp[1];
 U[2] = temp[2];
 U[3] = temp[6];
 U[4] = temp[7];
 U[5] = temp[0];
 U[6] = temp[4];
 U[7] = temp[5];



U[0] = U[0]^U[3];
U[7] = U[7]^U[2];
U[6] = U[6]^U[1];
U[3] = U[3]^U[6];
U[6] = U[6]^U[4];
U[4] = U[4]^U[7];
U[2] = U[2]^U[6];
U[7] = U[7]^U[5];
U[5] = U[5]^U[0];
U[0] = U[0]^U[1];
U[1] = U[1]^U[2];
U[2] = U[2]^U[3];
U[2] = U[2]^U[4];
U[2] = U[2]^U[5];

/***********************/


    U[0] = U[0] ^ U[6];               //U[0]=y_13
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5]; //U[6]=y_16
    T[0] = (U[0] & U[6]) ^ T[0];      //T[0]=t_7
    T[1] = T[1] ^ T[0];               //T[1]=t_7

    U[1] = U[1] ^ U[2] ^ U[7];               //U[1]=y_1
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6]; //U[2]=y_5
    T[1] = (U[1] & U[2]) ^ T[1];             //T[1]=t_9

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3]; //U[0]=y_9
    U[6] = U[6] ^ U[1] ^ U[7];        //U[6]=y_11
    T[2] = (U[0] & U[6]) ^ T[2];      //T[2]=t_12
    T[3] = T[3] ^ T[2];               //T[3]=t_12

    U[5] = U[5] ^ U[3];                      //U[5]=y_14
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; //U[0]=y_17
    T[3] = (U[5] & U[0]) ^ T[3];             // T[3]=t_14
    T[1] = T[1] ^ T[3];                      //  T[1]=t_19

    U[0] = U[0] ^ U[3] ^ U[4]; //  U[0]=y_21
    T[1] = T[1] ^ U[0];        //  T[1]=t_23

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7]; //U[0]=y_2
    U[6] = U[6] ^ U[7];                      //U[6]=y_7
    T[0] = (U[0] & U[6]) ^ T[0];             //T[0]=t_11

    U[0] = U[0] ^ U[2] ^ U[5];        // U[0]=y_12
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4]; // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];      // T[4]=t_2, ** first computation of t_2=U[0]& U[5]

    T[3] = T[3] ^ T[4];          // T[3]=t_19^t_2
    U[0] = U[0] ^ U[1] ^ U[3];   // U[0]=y_3
    U[5] = U[5] ^ U[7];          // U[5]=y_6
    T[3] = (U[0] & U[5]) ^ T[3]; // T[3]=t_19^t_4

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_20
    T[3] = T[3] ^ U[1];                      //  T[3]=t_21

    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6]; // U[1]=y_10
    U[0] = U[0] ^ U[2];               // U[0]=y_8
    T[2] = (U[1] & U[0]) ^ T[2];      // T[2]=t_16
    T[0] = T[0] ^ T[2];               // T[0]=t_20
    T[2] = T[2] ^ T[4];               // T[0]=t_16^t_2

    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5]; // U[0]=y_12
    U[5] = U[5] ^ U[7];                      // U[5]=y_15
    T[4] = (U[0] & U[5]) ^ T[4];             // T[4]=0, ** second computation of t_2=U[0]& U[5]

    // As shown in the above (with **), we need to compute t_2 two times.
    // If we introduce a new qubit (i.e. T[6]) to store t_2, we can save one Toffoli gate and one Toffoli depth.

    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6]; // U[2]=y_18
    T[0] = T[0] ^ U[2];                      // T[0]=t_24

    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7]; // U[1]=y_4
    T[2] = (U[1] & U[7]) ^ T[2];      // T[2]=t_18

    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7]; // U[0]=y_19
    T[2] = T[2] ^ U[0];                      // T[2]=t_22

    T[4] = (T[1] & T[3]) ^ T[4]; // T[4]=t_26
    T[1] = T[1] ^ T[0];          // T[1]=t_30
    T[4] = T[4] ^ T[2];          // T[4]=t_31
    T[5] = (T[1] & T[4]) ^ T[5]; // T[5]=t_32
    T[5] = T[5] ^ T[0];          // T[5]=t_33
    T[1] = T[1] ^ T[0] ^ T[5];   // T[1]=t_34
    T[4] = T[4] ^ T[2] ^ T[0];   // T[4]=t_27
    T[5] = T[5] ^ T[4];          // T[5]=t_35
    T[1] = (T[0] & T[5]) ^ T[1]; // T[1]=t_37  *** first computation of t_36=T[0]& T[5]
    T[3] = T[3] ^ T[2];          // T[3]=t_25
    T[2] = (T[3] & T[4]) ^ T[2]; // T[2]=t_29
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_38  *** second computation of t_36=T[0]& T[5]
    T[3] = (T[2] & T[4]) ^ T[3]; // T[3]=t_40
    T[4] = (T[0] & T[5]) ^ T[4]; // T[4]=t_27  *** third computation of t_36=T[0]& T[5]
    T[5] = T[5] ^ T[4];          // T[5]=t_33

    // As shown in the above (with ***), we need to compute t_36 three times.
    // If we introduce a new qubit (i.e. T[7]) to store t_36, we can save two Toffoli gate and two Toffoli depth.

    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];        // U[3]=y_5
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];               // U[4]=y_14
    U[2] = U[2] ^ U[6];                             // U[2]=y_2
    U[5] = U[5] ^ U[7];                             // U[5]=y_6
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5]; // U[6]=y_21
}

void algorithm_R2(int U[], int T[], int S[], int j)
{
	
int temp[8];


    
		
	
	/*** This part is used to generate the output of S-box, the result is stored in S[] ***/
    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_10
    T[3] = T[3] ^ T[1];               // T[3]=t_41

    S[5] = (T[3] & U[1]) ^ S[5]; //  T[3]& U[1]=z_8 and S[5]=z_8
    S[6] = S[6] ^ S[5];          //  S[6]=z_8

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];               // T[3]=t_33

    // S[0]=0,  S[1]=0 ,   S[2]=0,   S[3]=0,
    // S[4]=0,  S[5]=z_8,  S[6]=z_8, S[7]=0,

    S[2] = (T[2] & U[2]) ^ S[2]; // T[2]& U[2]=z_14 and S[2]=z_14
    S[5] = S[2] ^ S[5];          // S[5]=z_8^z_14
    S[2] = S[2] ^ S[6];          // S[2]=z_8^z_14
    
    // S[0]=0,  S[1]=0 ,        S[2]=z_8^z_14,   S[3]=0,
    // S[4]=0,  S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    S[4] = (T[1] & U[5]) ^ S[4]; //  T[1]& U[5]=z_1
    S[1] = S[1] ^ S[4];          //  S[1]=z_1
    S[3] = S[3] ^ S[4];          //  S[3]=z_1

    // S[0]=0,   S[1]=z_1,       S[2]=z_8^z_14,   S[3]=z_1,
    // S[4]=z_1, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=0,

    U[5] = U[5] ^ U[7]; // U[5]=y_15
    T[1] = T[1] ^ T[5]; // T[1]=t_44

    S[7] = (T[1] & U[5]) ^ S[7]; // T[1]& U[5]=z_0 and S[7]=z_0
    S[1] = S[1] ^ S[7];          // S[1]=z_1^z_0
    S[3] = S[3] ^ S[7];          // S[3]=z_1^z_0
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_0

    U[5] = U[5] ^ U[7]; // U[5]=y_6
    T[1] = T[1] ^ T[5]; // T[1]=t_37

    // S[0]=0,       S[1]=z_1^z_0,   S[2]=z_8^z_14,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14,  S[6]=z_8,        S[7]=z_0,

    S[7] = (T[5] & U[7]) ^ S[7]; // T[5]& U[7]=z_2 and S[7]=z_0^z_2
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2
    S[6] = S[6] ^ S[7];          // S[6]=z_8^z_0^z_2

    // S[0]=0,       S[1]=z_1^z_0,           S[2]=z_8^z_14^z_0^z_2,   S[3]=z_1^z_0,
    // S[4]=z_1^z_0, S[5]=z_8^z_14^z_0^z_2,  S[6]=z_8^z_0^z_2,        S[7]=z_0^z_2,

    // Done

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_7

    S[7] = (T[2] & U[1]) ^ S[7]; // T[2]& U[1]=z_5 and S[7]=z_0^z_2^z_5
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_5
    S[4] = S[4] ^ S[7];          // S[4]=z_1^z_2^z_5
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_5

    U[1] = U[1] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6]; // U[1]=y_4

    // S[0]=0,           S[1]=z_1^z_0,       S[2]=z_8^z_14^z_5,   S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_5,  S[6]=z_8^z_0^z_2,    S[7]=z_0^z_2^z_5,

    U[2] = U[2] ^ U[3]; // U[2]=y_13
    T[3] = T[3] ^ T[2]; // T[3]=t_43

    S[7] = (T[3] & U[2]) ^ S[7]; // T[3]& U[2]=z_12 and S[7]=z_0^z_2^z_5^z_12
    S[2] = S[2] ^ S[7];          // S[2]=z_8^z_14^z_0^z_2^z_12
    S[5] = S[5] ^ S[7];          // S[5]=z_8^z_14^z_0^z_2^z_12

    U[2] = U[2] ^ U[3]; // U[2]=y_2
    T[3] = T[3] ^ T[2]; // T[3]=t_40

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_0^z_2,            S[7]=z_0^z_2^z_5^z_12,

    S[7] = (T[3] & U[3]) ^ S[7]; //T[3]& U[3]=z_13 and S[7]=z_0^z_2^z_5^z_12^z_13
    S[6] = S[6] ^ S[7];          //S[6]= z_8^z_5^z_12^z_13

    // S[0]=0,           S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5, S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13,      S[7]=z_0^z_2^z_5^z_12^z_13,

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_16
    T[2] = T[3] ^ T[2];        // T[2]=t_43

    S[0] = (T[2] & U[6]) ^ S[0]; // T[2]& U[6]=z_3 and S[0]=z_3
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_3
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3

    U[6] = U[6] ^ U[3] ^ U[2]; // U[6]=y_21
    T[2] = T[3] ^ T[2];        // T[2]=t_29

    // S[0]=z_3,              S[1]=z_1^z_0,                S[2]=z_8^z_14^z_0^z_2^z_12,  S[3]=z_1^z_0,
    // S[4]=z_1^z_2^z_5^z_3,  S[5]=z_8^z_14^z_0^z_2^z_12,  S[6]=z_8^z_5^z_12^z_13^z_3,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_1

    S[0] = (T[3] & U[1]) ^ S[0]; // T[3]& U[1]=z_4 and S[0]=z_3^z_4
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_3^z_4
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4

    U[1] = U[1] ^ U[0] ^ U[4] ^ U[2] ^ U[5]; // U[1]=y_4

    // S[0]=z_3^z_4,          S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4,  S[6]=z_8^z_5^z_12^z_13^z_4,          S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_11
    T[5] = T[5] ^ T[2];                                    // T[5]=t_42

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_6 and S[0]=z_3^z_4^z_6
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_6
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6

    U[3] = U[7] ^ U[3] ^ U[0] ^ U[4] ^ U[5] ^ U[6] ^ U[1]; // U[3]=y_5
    T[5] = T[5] ^ T[2];                                    // T[5]=t_33

    // S[0]=z_3^z_4^z_6,      S[1]=z_1^z_0^z_3^z_4,            S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_3^z_4,
    // S[4]=z_1^z_2^z_5^z_4,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6,  S[6]=z_8^z_5^z_12^z_13^z_3^z_6,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_17
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_45

    S[0] = (T[5] & U[3]) ^ S[0]; // T[5]& U[3]=z_7 and S[0]=z_3^z_4^z_6^z_7
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_6^z_7
    S[4] = S[4] ^ S[0];          // S[4]= z_1^z_2^z_5^z_3^z_6^z_7
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7

    U[3] = U[7] ^ U[3] ^ U[2] ^ U[5] ^ U[6]; // U[3]=y_5
    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7,          S[1]=z_1^z_0^z_3^z_4,                    S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_12
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    S[0] = (T[5] & U[2]) ^ S[0]; // T[5]& U[2]=z_9 and S[0]=z_3^z_4^z_6^z_7^z_9
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9

    U[2] = U[2] ^ U[3] ^ U[4]; // U[2]=y_2
    T[5] = T[5] ^ T[1];        // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9,      S[1]=z_1^z_0^z_3^z_4,                S[2]=z_8^z_14^z_0^z_2^z_12^z_6,  S[3]=z_1^z_0^z_6^z_7,
    // S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,  S[6]=z_8^z_5^z_12^z_13^z_4^z_7,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3,

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_3

    S[0] = (T[1] & U[1]) ^ S[0]; // T[1]& U[1]=z_10 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10
    S[2] = S[2] ^ S[0];          // S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10

    U[1] = U[1] ^ U[3] ^ U[4] ^ U[2]; // U[1]=y_4

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_9^z_10,
    // S[3]=z_1^z_0^z_6^z_7,           S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                       S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    U[1] = U[1] ^ U[2]; // U[1]=y_9
    T[5] = T[5] ^ T[2]; // T[5]=t_42

    S[0] = (T[5] & U[1]) ^ S[0]; // T[5]& U[1]=z_15 and S[0]= z_3^z_4^z_6^z_7^z_9^z_10^z_15
    S[2] = S[2] ^ S[0];          // S[2]= z_8^z_14^z_0^z_2^z_12^z_6^z_15

    U[1] = U[1] ^ U[2]; // U[1]=y_4
    T[5] = T[5] ^ T[2]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15,  S[1]=z_1^z_0^z_3^z_4,          S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_6^z_7,                S[4]=z_1^z_2^z_5^z_3^z_6^z_7,  S[5]=z_8^z_14^z_0^z_2^z_12^z_6^z_9,
    // S[6]=z_8^z_5^z_12^z_13^z_3^z_6^z_9^z_10,                            S[7]=z_0^z_2^z_5^z_12^z_13^z_4^z_6^z_7^z_9^z_10,

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_45

    S[0] = (T[5] & U[4]) ^ S[0]; // T[5]& U[4]=z_16 and S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16
    S[1] = S[1] ^ S[0];          // S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16
    S[3] = S[3] ^ S[0];          // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16
    S[4] = S[4] ^ S[0];          // S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16
    S[5] = S[5] ^ S[0];          // S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16
    S[6] = S[6] ^ S[0];          // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16
    S[7] = S[7] ^ S[0];          // S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16

    T[5] = T[5] ^ T[2] ^ T[1] ^ T[3]; // T[5]=t_33

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_8
    T[3] = T[3] ^ T[1];        // T[3]=t_41

    S[2] = (T[3] & U[1]) ^ S[2]; // T[3]& U[1]=z_17 and S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17

    U[1] = U[1] ^ U[4] ^ U[2]; // U[1]=y_4
    T[3] = T[3] ^ T[1];        // T[3]=t_40

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,      S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,

    S[5] = (T[5] & U[1]) ^ S[5]; //  T[5]& U[1]=z_11 and S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11

    // S[0]=z_3^z_4^z_6^z_7^z_9^z_10^z_15^z_16,   S[1]=z_1^z_0^z_6^z_7^z_9^z_10^z_15^z_16,  S[2]=z_8^z_14^z_0^z_2^z_12^z_6^z_15^z_17,
    // S[3]=z_1^z_0^z_3^z_4^z_9^z_10^z_15^z_16,   S[4]=z_1^z_2^z_5^z_4^z_9^z_10^z_15^z_16,  S[5]=z_8^z_14^z_0^z_2^z_12^z_3^z_4^z_7^z_10^z_15^z_16^z_11,
    // S[6]=z_8^z_5^z_12^z_13^z_4^z_7^z_15^z_16,  S[7]=z_0^z_2^z_5^z_12^z_13^z_3^z_15^z_16,


/* Inverse of L with rewiring  and 14 CNOT gates */


//rewiring 
temp[0] = S[0];
temp[1] = S[1];
temp[2] = S[2];
temp[3] = S[3];
temp[4] = S[4];
temp[5] = S[5];
temp[6] = S[6];
temp[7] = S[7];


 S[0] = temp[3];
 S[1] = temp[1];
 S[2] = temp[2];
 S[3] = temp[6];
 S[4] = temp[7];
 S[5] = temp[0];
 S[6] = temp[4];
 S[7] = temp[5];



S[0] = S[0]^S[3];
S[7] = S[7]^S[2];
S[6] = S[6]^S[1];
S[3] = S[3]^S[6];
S[6] = S[6]^S[4];
S[4] = S[4]^S[7];
S[2] = S[2]^S[6];
S[7] = S[7]^S[5];
S[5] = S[5]^S[0];
S[0] = S[0]^S[1];
S[1] = S[1]^S[2];
S[2] = S[2]^S[3];
S[2] = S[2]^S[4];
S[2] = S[2]^S[5];
/*****************************/


    /*** This part is used to generate the input of S-box, the result is stored in U[] ***/
    U[6] = U[6] ^ U[0] ^ U[1] ^ U[3] ^ U[4] ^ U[5];
    U[5] = U[5] ^ U[7];
    U[2] = U[2] ^ U[6];
    U[4] = U[4] ^ U[0] ^ U[3] ^ U[7];
    U[3] = U[3] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[5] = T[5] ^ T[4];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[3] = (T[2] & T[4]) ^ T[3];
    T[4] = (T[0] & T[5]) ^ T[4];
    T[2] = (T[3] & T[4]) ^ T[2];
    T[3] = T[3] ^ T[2];
    T[1] = (T[0] & T[5]) ^ T[1];
    T[5] = T[5] ^ T[4];

    T[4] = T[4] ^ T[2] ^ T[0];
    T[1] = T[1] ^ T[0] ^ T[5];
    T[5] = T[5] ^ T[0];
    T[5] = (T[1] & T[4]) ^ T[5];
    T[4] = T[4] ^ T[2];
    T[1] = T[1] ^ T[0];
    T[4] = (T[1] & T[3]) ^ T[4];

    T[2] = T[2] ^ U[0];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];

    T[2] = (U[1] & U[7]) ^ T[2];
    U[1] = U[1] ^ U[3] ^ U[5] ^ U[7];

    T[0] = T[0] ^ U[2];
    U[2] = U[2] ^ U[3] ^ U[4] ^ U[5] ^ U[6];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3] ^ U[5];

    T[2] = T[2] ^ T[4];
    T[0] = T[0] ^ T[2];
    T[2] = (U[1] & U[0]) ^ T[2];
    U[0] = U[0] ^ U[2];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[6];

    T[3] = T[3] ^ U[1];
    U[1] = U[1] ^ U[2] ^ U[4] ^ U[5] ^ U[6];

    T[3] = (U[0] & U[5]) ^ T[3];
    U[5] = U[5] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[3];
    T[3] = T[3] ^ T[4];

    T[4] = (U[0] & U[5]) ^ T[4];
    U[5] = U[5] ^ U[0] ^ U[3] ^ U[4];
    U[0] = U[0] ^ U[2] ^ U[5];

    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[6] ^ U[7];

    T[1] = T[1] ^ U[0];
    U[0] = U[0] ^ U[3] ^ U[4];

    T[1] = T[1] ^ T[3];
    T[3] = (U[5] & U[0]) ^ T[3];
    U[0] = U[0] ^ U[2] ^ U[4] ^ U[6] ^ U[7];
    U[5] = U[5] ^ U[3];

    T[3] = T[3] ^ T[2];
    T[2] = (U[0] & U[6]) ^ T[2];
    U[6] = U[6] ^ U[1] ^ U[7];
    U[0] = U[0] ^ U[1] ^ U[2] ^ U[3];

    T[1] = (U[1] & U[2]) ^ T[1];
    U[2] = U[2] ^ U[1] ^ U[4] ^ U[5] ^ U[6];
    U[1] = U[1] ^ U[2] ^ U[7];

    T[1] = T[1] ^ T[0];
    T[0] = (U[0] & U[6]) ^ T[0];
    U[6] = U[6] ^ U[2] ^ U[4] ^ U[5];
    U[0] = U[0] ^ U[6];

	
 
/*   Linear Transformation  L in the AES sbox with 14 CNOT gates and rewiring */


//14 CNOT gates
U[2] = U[2]^U[5];
U[2] = U[2]^U[4];
U[2] = U[2]^U[3];
U[1] = U[1]^U[2];
U[0] = U[0]^U[1];
U[5] = U[5]^U[0];
U[7] = U[7]^U[5];
U[2] = U[2]^U[6];
U[4] = U[4]^U[7];
U[6] = U[6]^U[4];
U[3] = U[3]^U[6];
U[6] = U[6]^U[1];
U[7] = U[7]^U[2];
U[0] = U[0]^U[3];


//Rewiring
temp[3] = U[0];
temp[1] = U[1];
temp[2] = U[2];
temp[6] = U[3];
temp[7] = U[4];
temp[0] = U[5];
temp[4] = U[6];
temp[5] = U[7];

U[0] = temp[0];
U[1] = temp[1];
U[2] = temp[2];
U[3] = temp[3];
U[4] = temp[4];
U[5] = temp[5];
U[6] = temp[6];
U[7] = temp[7];

/*********************************/


U[1] = 1^U[1];
U[2] = 1^U[2];
U[6] = 1^U[6];
U[7] = 1^U[7];

}

int main()
{
	int U[8], T[6], U1[8], T1[8], S4[8], S1[8], S2[8], S3[8]={1,0,1,0,0,1,0,1}, j = 0,  ii, jj, input, output, diff;

	long  X, SR[16]={128,64,32,16,8,4,2,1,0,0,0,0,0,0,0,0}, 
        
        x[32] = {   0x80000000,
                    0x40000000,
                    0x20000000,
                    0x10000000,
                    0x08000000,
                    0x04000000,
                    0x02000000,
                    0x01000000,
                    0x00800000,
                    0x00400000,
                    0x00200000,
                    0x00100000,
                    0x00080000,
                    0x00040000,
                    0x00020000,
                    0x00010000,
                    0x00008000,
                    0x00004000,
                    0x00002000,
                    0x00001000,
                    0x00000800,
                    0x00000400,
                    0x00000200,
                    0x00000100,
                    0x00000080,
                    0x00000040,
                    0x00000020,
                    0x00000010,
                    0x00000008,
                    0x00000004,
                    0x00000002,
                    0x00000001
                }
        ;




    printf("\n******************** Checking the Output of a C^0-circuit of the S-box***************** \n");

    for (X = 0; X < 256; ++X)
    {
        for (ii = 0; ii < 6; ++ii)
            T[ii] = 0;
        for (ii = 0; ii < 8; ++ii)
            U[ii] = (X >> (7 - ii)) & 1;
        //algorithm 3
        algorithm_3(U, T);

        //algorithm 4
        for (ii = 0; ii < 8; ++ii)
            S1[ii] = 0;
        algorithm_4(U, T, S1, j);

        for (input = 0, output = 0, ii = 0; ii < 8; ++ii)
        {
            input = (input << 1) | U[ii];
            output = (output << 1) | S1[ii];
		
        }
        printf("%02X: %02X  ", input, output);
        if (X % 16 == 15)
            printf("\n");
    }

	printf("\n******************** Checking the Output of a C*-circuit of the S-box***************** \n");

	j = 0;
	  for (X = 0; X < 256; ++X)
    {
        for (ii = 0; ii < 6; ++ii)
            T[ii] = 0;
        for (ii = 0; ii < 8; ++ii)
            U[ii] = (X >> (7 - ii)) & 1;
        //algorithm 3
        algorithm_3(U, T);

        //algorithm L
		for (ii = 0; ii < 8; ++ii)
		{
			S2[ii] = S3[ii];
		}

        algorithm_L(U, T, S2, j);

        for (input = 0, output = 0, ii = 0; ii < 8; ++ii)
        {
            input = (input << 1) | U[ii];
            output =  (output << 1) | (S2[ii]^S3[ii]) ;
			//diff =  (diff << 1) | (S3[X][ii]^(S2[ii]^1));
        }
        printf("%02X: %02X  ", input, output);
        if (X % 16 == 15)
            printf("\n");
    }


	  	printf("\n******************** Checking the Output of a C^0-circuit of the Sbox -1 *****************\n");

	   for (X = 0; X < 256; ++X)
    {
        for (ii = 0; ii < 6; ++ii)
            T1[ii] = 0;
        for (ii = 0; ii < 8; ++ii)
            U1[ii] = (X >> (7 - ii)) & 1;
        //algorithm R1
        algorithm_R1(U1, T1);

        //algorithm R2
		for (ii = 0; ii < 8; ++ii)
		{
			S2[ii] = 0;
		}

        algorithm_R2(U1, T1, S2, j);

        for (input = 0, output = 0, ii = 0; ii < 8; ++ii)
        {
		//	U1[ii] = (X >> (7 - ii)) & 1;
            input = (input << 1) | U1[ii];
            output =  (output << 1) | (S2[ii]) ;
			//diff =  (diff << 1) | (S3[X][ii]^(S2[ii]^1));
        }
        printf("%02X: %02X  ", input, output);
        if (X % 16 == 15)
            printf("\n");
    }

	system("pause");

}
